<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>connection (postgresql.Postgresql.connection)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">postgresql</a></span></nav><header><h1><span class="keyword">Class</span> <span class="module-path">Postgresql.connection</span></h1></header><div class="doc"><p>Class of connections.</p><p>When <code class="code">conninfo</code> is given, it will be used instead of all other
optional arguments.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">startonly</span>: If true, initiate a non-blocking connect procedure, which
involves cooperative calls to <a href="index.html#method-connect_poll">connect_poll</a> before the connection is
usable.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection failure.</li></ul></div><div class="spec method" id="method-finish"><a href="#method-finish" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>finish : unit</code></div><div class="doc"><p><code class="code">#finish</code> closes the connection.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-try_reset"><a href="#method-try_reset" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>try_reset : unit</code></div><div class="doc"><p><code class="code">#try_reset</code> tries to reset the connection if it is bad. If
resetting fails, the <code class="code">error</code> exception will be raised with
<code class="code">Connection_failure</code>.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-reset"><a href="#method-reset" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>reset : unit</code></div><div class="doc"><p><code class="code">#reset</code> resets the connection.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><p>Asynchronous Notification</p><div class="spec method" id="method-notifies"><a href="#method-notifies" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>notifies : <a href="../Notification/index.html#type-t">Notification.t</a> option</code></div><div class="doc"><p><code class="code">#notifies</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> <code class="code">Some notification</code> if available (<code class="code">None</code> otherwise).</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><p>Control Functions</p><div class="spec method" id="method-set_notice_processor"><a href="#method-set_notice_processor" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>set_notice_processor : (string <span class="keyword">&#8209;&gt;</span> unit) <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">#set_notice_processor</code> controls reporting of notice and warning
messages generated by a connection.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><p>Accessors</p><div class="spec method" id="method-db"><a href="#method-db" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>db : string</code></div><div class="doc"><p><code class="code">#db</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> database name of the connection.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-user"><a href="#method-user" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>user : string</code></div><div class="doc"><p><code class="code">#user</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> user name of the connection.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-pass"><a href="#method-pass" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>pass : string</code></div><div class="doc"><p><code class="code">#pass</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> password of the connection.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-host"><a href="#method-host" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>host : string</code></div><div class="doc"><p><code class="code">#host</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> server host name of the connection.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-port"><a href="#method-port" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>port : string</code></div><div class="doc"><p><code class="code">#port</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> port of the connection.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-tty"><a href="#method-tty" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>tty : string</code></div><div class="doc"><p><code class="code">#tty</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> debug tty of the connection.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-options"><a href="#method-options" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>options : string</code></div><div class="doc"><p><code class="code">#options</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> backend options of the connection.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-status"><a href="#method-status" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>status : <a href="../index.html#type-connection_status">connection_status</a></code></div><div class="doc"><p><code class="code">#status</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> current connection status.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-error_message"><a href="#method-error_message" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>error_message : string</code></div><div class="doc"><p><code class="code">#error_message</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> most recent error message of the connection.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-backend_pid"><a href="#method-backend_pid" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>backend_pid : int</code></div><div class="doc"><p><code class="code">#backend</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> process id of the backend server of the connection.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-server_version"><a href="#method-server_version" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>server_version : int<span class="keyword"> * </span>int<span class="keyword"> * </span>int</code></div><div class="doc"></div></div><p>Commands and Queries</p><div class="spec method" id="method-empty_result"><a href="#method-empty_result" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>empty_result : <a href="../index.html#type-result_status">result_status</a> <span class="keyword">&#8209;&gt;</span> <a href="../class-type-result/index.html">result</a></code></div><div class="doc"><p><code class="code">empty_result stat</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> dummy result with a given status <code class="code">stat</code>.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-exec"><a href="#method-exec" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>exec : ?&#8288;expect:<a href="../index.html#type-result_status">result_status</a> list <span class="keyword">&#8209;&gt;</span> ?&#8288;params:string array <span class="keyword">&#8209;&gt;</span> ?&#8288;binary_params:bool array <span class="keyword">&#8209;&gt;</span> ?&#8288;binary_result:bool <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> <a href="../class-type-result/index.html">result</a></code></div><div class="doc"><p><code class="code">exec ?expect ?params ?binary_params ?binary_result query</code>
synchronous execution of query or command <code class="code">query</code>. The result
status will be checked against all elements in <code class="code">expect</code>. If
<code class="code">expect</code> is not empty and if there is no match, the exception
<code class="code">Unexpected_status</code> will be raised.</p><p>Additional query parameters can be passed in the <code class="code">params</code> array.
They must not be escaped and they can be referred to in <code class="code">query</code>
as $1, $2, ... The value <code class="code">null</code> can be used in the <code class="code">params</code>
array to denote an SQL NULL. It is possible to specify that some
of the query parameters are passed as binary strings using the
<code class="code">binary_params</code> array. By default, results are returned in text
format, but will be returned in binary format if <code class="code">binary_result</code>
is true.</p><p>If no (or an empty) query parameter is passed, it is possible to
emit several commands with a single call.</p><ul class="at-tag"><li><span class="at-tag return">Returns</span> result of query.</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">expect</span>: default = <code class="code"></code></li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">params</span>: default = <code class="code">||</code></li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">binary_params</span>: default = <code class="code">||</code></li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">binary_result</span>: default = false</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is an unexpected result status.</li></ul></div></div><div class="spec method" id="method-prepare"><a href="#method-prepare" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>prepare : string <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> <a href="../class-type-result/index.html">result</a></code></div><div class="doc"><p><code class="code">prepare stm_name query</code> creates a prepared query named <code class="code">stm_name</code>
which will execute the query or command <code class="code">query</code> when passed to
<code class="code">#exec_prepared</code>.</p></div></div><div class="spec method" id="method-exec_prepared"><a href="#method-exec_prepared" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>exec_prepared : ?&#8288;expect:<a href="../index.html#type-result_status">result_status</a> list <span class="keyword">&#8209;&gt;</span> ?&#8288;params:string array <span class="keyword">&#8209;&gt;</span> ?&#8288;binary_params:bool array <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> <a href="../class-type-result/index.html">result</a></code></div><div class="doc"><p><code class="code">exec_prepared ?expect ?params ?binary_params stm_name</code> acts as
<code class="code">#exec</code>, except executes the prepared query <code class="code">stm_name</code>.</p></div></div><div class="spec method" id="method-describe_prepared"><a href="#method-describe_prepared" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>describe_prepared : string <span class="keyword">&#8209;&gt;</span> <a href="../class-type-result/index.html">result</a></code></div><div class="doc"><p><code class="code">#describe_prepared stm_name</code> submits a request to obtain
information about the specified prepared statement, and waits for
completion. <a href="index.html#method-describe_prepared">describe_prepared</a> allows an application to obtain
information about a previously prepared statement. The <code class="code">stm_name</code>
parameter can be the empty string (&quot;&quot;) to reference the unnamed
statement, otherwise it must be the name of an existing prepared
statement. On success, a <a href="../class-type-result/index.html">result</a> with status <code class="code">Command_ok</code> is
returned. The methods <a href="../class-type-result/index.html#method-nparams">result.nparams</a> and <a href="../class-type-result/index.html#method-paramtype">result.paramtype</a>
of the class <code class="code">result</code> can be used to obtain information about
the parameters of the prepared statement, and the methods
<a href="../class-type-result/index.html#method-nfields">result.nfields</a>, <a href="../class-type-result/index.html#method-fname">result.fname</a> and <a href="../class-type-result/index.html#method-ftype">result.ftype</a> provide
information about the result columns (if any) of the statement.</p><p>To prepare a statement use the SQL command PREPARE.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">stm_name</span>: The name of the previously prepared query</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li><li><span class="at-tag see">See</span> <a href="http://www.postgresql.org/docs/8.3/interactive/sql-prepare.html">http://www.postgresql.org/docs/8.3/interactive/sql-prepare.html</a>PostgreSQL documentation about <code class="code">PREPARE</code></li></ul></div></div><div class="spec method" id="method-send_query"><a href="#method-send_query" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>send_query : ?&#8288;params:string array <span class="keyword">&#8209;&gt;</span> ?&#8288;binary_params:bool array <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">send_query ?params ?binary_params query</code> asynchronous execution
of query or command <code class="code">query</code>.</p><p>Additional query parameters can be passed in the <code class="code">params</code> array.
They must not be escaped and they can be referred to in <code class="code">query</code>
as $1, $2, ... The value <code class="code">null</code> can be used in the <code class="code">params</code>
array to denote an SQL NULL. It is possible to specify that some
of the query parameters are passed as binary strings using the
<code class="code">binary_params</code> array.</p><p>If no (or an empty) query parameter is passed, it is possible to
emit several commands with a single call.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">params</span>: default = <code class="code">||</code></li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">binary_params</span>: default = <code class="code">||</code></li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-send_prepare"><a href="#method-send_prepare" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>send_prepare : string <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">#send_prepare stm_name query</code> sends a query preparation without waiting
for the result. This does the same as <a href="index.html#method-prepare">prepare</a> except that the status
is reported by <a href="index.html#method-get_result">get_result</a> when available.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-send_query_prepared"><a href="#method-send_query_prepared" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>send_query_prepared : ?&#8288;params:string array <span class="keyword">&#8209;&gt;</span> ?&#8288;binary_params:bool array <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">#send_query_prepared ?params ?binary_params stm_name</code> is an
asynchronous version of query_prepared. The semantics is otherwise
the same, and the result is reported by <a href="index.html#method-get_result">get_result</a> when available.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">params</span>: default = <code class="code">||</code></li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">binary_params</span>: default = <code class="code">||</code></li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-send_describe_prepared"><a href="#method-send_describe_prepared" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>send_describe_prepared : string <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">#send_describe_prepared stm_name</code> sends a request for a description of
a prepared query without waiting for the result. The result must be
fetched with <a href="index.html#method-get_result">get_result</a> when it becomes available. Otherwise it
does the same as <a href="index.html#method-describe_prepared">describe_prepared</a>.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-send_describe_portal"><a href="#method-send_describe_portal" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>send_describe_portal : string <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">#send_describe_portal portal_name</code> sends a request for a description of
the named portal. The result must be fetched with <a href="index.html#method-get_result">get_result</a>.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-set_single_row_mode"><a href="#method-set_single_row_mode" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>set_single_row_mode : unit</code></div><div class="doc"><p><code class="code">#set_single_row_mode</code> called right after <a href="index.html#method-send_query">send_query</a> or a sibling
function causes the returned rows to be split into individual results.</p></div></div><div class="spec method" id="method-get_result"><a href="#method-get_result" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>get_result : <a href="../class-type-result/index.html">result</a> option</code></div><div class="doc"><p><code class="code">get_result</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> <code class="code">Some result</code> of an asynchronous query if
available or <code class="code">None</code>.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><p>Low level</p><p>Copy operations</p><div class="spec method" id="method-getline"><a href="#method-getline" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>getline : ?&#8288;pos:int <span class="keyword">&#8209;&gt;</span> ?&#8288;len:int <span class="keyword">&#8209;&gt;</span> Bytes.t <span class="keyword">&#8209;&gt;</span> <a href="../index.html#type-getline_result">getline_result</a></code></div><div class="doc"><p><code class="code">getline ?pos ?len buf</code> reads a newline-terminated line of at most
<code class="code">len</code> characters into <code class="code">buf</code> starting at position <code class="code">pos</code>.</p><ul class="at-tag"><li><span class="at-tag return">Returns</span> getline_result</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">pos</span>: default = 0</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">len</span>: default = Bytes.length buf - pos</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Invalid_argument</span>: if the buffer parameters are invalid.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-getline_async"><a href="#method-getline_async" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>getline_async : ?&#8288;pos:int <span class="keyword">&#8209;&gt;</span> ?&#8288;len:int <span class="keyword">&#8209;&gt;</span> Bytes.t <span class="keyword">&#8209;&gt;</span> <a href="../index.html#type-getline_async_result">getline_async_result</a></code></div><div class="doc"><p><code class="code">getline_async ?pos ?len buf</code> reads a newline-terminated line of
at most <code class="code">len</code> characters into <code class="code">buf</code> starting at position <code class="code">pos</code>
(asynchronously). No need to call <code class="code">endcopy</code> after receiving
<code class="code">EndOfData</code>.</p><ul class="at-tag"><li><span class="at-tag return">Returns</span> getline_async_result</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">pos</span>: default = 0</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">len</span>: default = Bytes.length buf - pos</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Invalid_argument</span>: if the buffer parameters are invalid.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-putline"><a href="#method-putline" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>putline : string <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">putline str</code> sends <code class="code">str</code> to backend server. Don't use this method
for binary data, use putnbytes instead!</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-putnbytes"><a href="#method-putnbytes" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>putnbytes : ?&#8288;pos:int <span class="keyword">&#8209;&gt;</span> ?&#8288;len:int <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">putnbytes ?pos ?len buf</code> sends the substring of <code class="code">buf</code> of length
<code class="code">len</code> starting at <code class="code">pos</code> to backend server (use this method for
binary data).</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">pos</span>: default = 0</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">len</span>: default = String.length buf - pos</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Invalid_argument</span>: if the buffer parameters are invalid.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-endcopy"><a href="#method-endcopy" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>endcopy : unit</code></div><div class="doc"><p><code class="code">endcopy</code> synchronizes with the backend.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><p>High level</p><div class="spec method" id="method-copy_out"><a href="#method-copy_out" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>copy_out : (string <span class="keyword">&#8209;&gt;</span> unit) <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">copy_out f</code> applies <code class="code">f</code> to each line returned by backend server.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-copy_out_channel"><a href="#method-copy_out_channel" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>copy_out_channel : Pervasives.out_channel <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">copy_out_channel ch</code> sends each line returned by backend server
to output channel <code class="code">ch</code>.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-copy_in_channel"><a href="#method-copy_in_channel" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>copy_in_channel : Pervasives.in_channel <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">copy_in_channel ch</code> sends each line in input channel <code class="code">ch</code> to
backend server.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><p>Asynchronous operations and non blocking mode</p><div class="spec method" id="method-connect_poll"><a href="#method-connect_poll" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>connect_poll : <a href="../index.html#type-polling_status">polling_status</a></code></div><div class="doc"><p>After creating a connection with <code class="code">~startonly:true</code>, <a href="index.html#method-connect_poll">connect_poll</a>
must be called a number of times before the connection can be used.
The precise procedure is described in the libpq manual, but the following
code should capture the idea, assuming monadic concurrency primitives
<code class="code">return</code> and <code class="code">&gt;&gt;=</code> along with polling functions <code class="code">wait_for_read</code> and
<code class="code">wait_for_write</code>:
</p><pre><code class="code">        let my_async_connect () =
          let c = new connection () in
          let rec establish_connection = function
            | Polling_failed | Polling_ok -&gt; return c
            | Polling_reading -&gt; wait_for_read c#socket &gt;&gt;= fun () -&gt;
                                 establish_connection c#connect_poll
            | Polling_writing -&gt; wait_for_write c#socket &gt;&gt;= fun () -&gt;
                                 establish_connection c#connect_poll in
          establish_connection Polling_writing</code></pre><p>
See also <code class="code">examples/async.ml</code>.</p></div></div><div class="spec method" id="method-reset_start"><a href="#method-reset_start" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>reset_start : bool</code></div><div class="doc"><p>An asynchronous variant of <a href="index.html#method-reset">reset</a>. Use <a href="index.html#method-reset_poll">reset_poll</a> to
finish re-establishing the connection.</p></div></div><div class="spec method" id="method-reset_poll"><a href="#method-reset_poll" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>reset_poll : <a href="../index.html#type-polling_status">polling_status</a></code></div><div class="doc"><p>Used analogously to <a href="index.html#method-connect_poll">connect_poll</a> after calling <a href="index.html#method-reset_start">reset_start</a>.</p></div></div><div class="spec method" id="method-set_nonblocking"><a href="#method-set_nonblocking" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>set_nonblocking : bool <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">set_nonblocking b</code> sets state of the connection to nonblocking if
<code class="code">b</code> is true and to blocking otherwise.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-is_nonblocking"><a href="#method-is_nonblocking" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>is_nonblocking : bool</code></div><div class="doc"><p><code class="code">is_nonblocking</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> the blocking status of the connection.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-consume_input"><a href="#method-consume_input" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>consume_input : unit</code></div><div class="doc"><p><code class="code">consume_input</code> consume any available input from backend.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-is_busy"><a href="#method-is_busy" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>is_busy : bool</code></div><div class="doc"><p><code class="code">is_busy</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> busy status of a query.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-flush"><a href="#method-flush" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>flush : <a href="../index.html#type-flush_status">flush_status</a></code></div><div class="doc"><p><code class="code">flush</code> attempts to flush any data queued to the backend.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-socket"><a href="#method-socket" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>socket : int</code></div><div class="doc"><p><code class="code">socket</code> obtains the file descriptor for the backend connection
socket as an integer.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-request_cancel"><a href="#method-request_cancel" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>request_cancel : unit</code></div><div class="doc"><p><code class="code">request_cancel</code> requests that PostgreSQL abandon processing of
the current command.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection or cancel error.</li></ul></div></div><p>Large objects</p><div class="spec method" id="method-lo_creat"><a href="#method-lo_creat" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>lo_creat : <a href="../index.html#type-oid">oid</a></code></div><div class="doc"><p><code class="code">lo_creat</code> creates a new large object and returns its oid.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-lo_import"><a href="#method-lo_import" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>lo_import : string <span class="keyword">&#8209;&gt;</span> <a href="../index.html#type-oid">oid</a></code></div><div class="doc"><p><code class="code">lo_import filename</code> imports an operating system file given by
<code class="code">filename</code> as a large object.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-lo_export"><a href="#method-lo_export" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>lo_export : <a href="../index.html#type-oid">oid</a> <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">lo_export oid filename</code> exports the large object given by <code class="code">oid</code>
to an operating system file given by <code class="code">filename</code>.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-lo_open"><a href="#method-lo_open" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>lo_open : <a href="../index.html#type-oid">oid</a> <span class="keyword">&#8209;&gt;</span> <a href="../index.html#type-large_object">large_object</a></code></div><div class="doc"><p><code class="code">lo_open oid</code> opens the large object given by <code class="code">oid</code> for reading and
writing.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-lo_write"><a href="#method-lo_write" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>lo_write : ?&#8288;pos:int <span class="keyword">&#8209;&gt;</span> ?&#8288;len:int <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> <a href="../index.html#type-large_object">large_object</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">lo_write ?pos ?len buf lo</code> writes <code class="code">len</code> bytes of buffer <code class="code">buf</code>
starting at position <code class="code">pos</code> to large object <code class="code">lo</code>.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">pos</span>: default = 0</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">len</span>: default = String.length buf - pos</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Invalid_argument</span>: if the buffer parameters are invalid.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if <code class="code">len</code> bytes could not be written.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-lo_write_ba"><a href="#method-lo_write_ba" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>lo_write_ba : ?&#8288;pos:int <span class="keyword">&#8209;&gt;</span> ?&#8288;len:int <span class="keyword">&#8209;&gt;</span> (char, Bigarray.int8_unsigned_elt, Bigarray.c_layout) Bigarray.Array1.t <span class="keyword">&#8209;&gt;</span> <a href="../index.html#type-large_object">large_object</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p>As <code class="code">lo_write</code>, but performs a zero-copy write from the given Bigarray.</p></div></div><div class="spec method" id="method-lo_read"><a href="#method-lo_read" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>lo_read : <a href="../index.html#type-large_object">large_object</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;pos:int <span class="keyword">&#8209;&gt;</span> ?&#8288;len:int <span class="keyword">&#8209;&gt;</span> Bytes.t <span class="keyword">&#8209;&gt;</span> int</code></div><div class="doc"><p><code class="code">lo_read lo ?pos ?len buf</code> reads <code class="code">len</code> bytes from large object <code class="code">lo</code>
to buffer <code class="code">buf</code> starting at position <code class="code">pos</code>.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">pos</span>: default = 0</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">len</span>: default = Bytes.length buf - pos</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Invalid_argument</span>: if the buffer parameters are invalid.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if <code class="code">len</code> bytes could not be read.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-lo_read_ba"><a href="#method-lo_read_ba" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>lo_read_ba : <a href="../index.html#type-large_object">large_object</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;pos:int <span class="keyword">&#8209;&gt;</span> ?&#8288;len:int <span class="keyword">&#8209;&gt;</span> (char, Bigarray.int8_unsigned_elt, Bigarray.c_layout) Bigarray.Array1.t <span class="keyword">&#8209;&gt;</span> int</code></div><div class="doc"><p>As <code class="code">lo_read</code>, but performs a zero-copy read into the given Bigarray.</p></div></div><div class="spec method" id="method-lo_seek"><a href="#method-lo_seek" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>lo_seek : ?&#8288;pos:int <span class="keyword">&#8209;&gt;</span> ?&#8288;whence:<a href="../index.html#type-seek_cmd">seek_cmd</a> <span class="keyword">&#8209;&gt;</span> <a href="../index.html#type-large_object">large_object</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">lo_seek ?pos ?whence lo</code> seeks read/write position <code class="code">pos</code> in
large object <code class="code">lo</code> relative to the start, current read/write
position, or end of the object (<code class="code">whence</code> is SEEK_SET, SEEK_CUR,
SEEK_END respectively).</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">pos</span>: default = 0</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">whence</span>: default = <code class="code">SEEK_SET</code></li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-lo_tell"><a href="#method-lo_tell" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>lo_tell : <a href="../index.html#type-large_object">large_object</a> <span class="keyword">&#8209;&gt;</span> int</code></div><div class="doc"><p><code class="code">lo_tell lo</code></p><ul class="at-tag"><li><span class="at-tag return">Returns</span> current read/write position of large object <code class="code">lo</code>.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-lo_close"><a href="#method-lo_close" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>lo_close : <a href="../index.html#type-large_object">large_object</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">lo_close lo</code> closes large object <code class="code">lo</code>.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><div class="spec method" id="method-lo_unlink"><a href="#method-lo_unlink" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>lo_unlink : <a href="../index.html#type-oid">oid</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">lo_unlink oid</code> removes the large object specified by <code class="code">oid</code> from the
database.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Error</span>: if there is a connection error.</li></ul></div></div><p>Escaping</p><div class="spec method" id="method-escape_string"><a href="#method-escape_string" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>escape_string : ?&#8288;pos:int <span class="keyword">&#8209;&gt;</span> ?&#8288;len:int <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> string</code></div><div class="doc"><p><code class="code">escape_string ?pos ?len str</code> escapes ASCII-substring <code class="code">str</code>
of length <code class="code">len</code> starting at position <code class="code">pos</code> for use within SQL.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">pos</span>: default = 0</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">len</span>: default = String.length str - pos</li></ul></div></div><div class="spec method" id="method-escape_bytea"><a href="#method-escape_bytea" class="anchor"></a><div class="def method"><code><span class="keyword">method </span>escape_bytea : ?&#8288;pos:int <span class="keyword">&#8209;&gt;</span> ?&#8288;len:int <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> string</code></div><div class="doc"><p><code class="code">escape_bytea ?pos ?len str</code> escapes binary substring <code class="code">str</code>
of length <code class="code">len</code> starting at position <code class="code">pos</code> for use within SQL.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">pos</span>: default = 0</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">len</span>: default = String.length str - pos</li></ul></div></div></body></html>